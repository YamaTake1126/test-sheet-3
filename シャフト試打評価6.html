<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚´ãƒ«ãƒ•ã‚¯ãƒ©ãƒ–è©•ä¾¡ï¼ˆé…å¸ƒç”¨ãƒ»è©•ä¾¡ãƒ¢ãƒ¼ãƒ‰å›ºå®šï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:system-ui,sans-serif;
  margin:8px;
  background:#f2f2f2;
}
h1{
  font-size:18px;
  text-align:center;
}
button{
  font-size:14px;
  padding:8px 10px;
  margin:2px;
}
input[type=text],
input[type=number]{
  font-size:16px;
  padding:6px;
}

.card{
  background:#fff;
  border-radius:8px;
  padding:8px;
  margin-bottom:10px;
  box-shadow:0 1px 3px rgba(0,0,0,.1);
}

.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.topbox{
  background:#fafafa;
  border:1px solid #ddd;
  border-radius:6px;
  padding:6px;
  margin-bottom:6px;
}

.fixed-name{
  font-size:16px;
  font-weight:bold;
  padding:6px;
  background:#eee;
  border-radius:4px;
}

table{
  width:100%;
  border-collapse:collapse;
}

th,td{
  border:1px solid #ccc;
  padding:6px;
  vertical-align:middle;
}

th{
  background:#eee;
  font-size:16px;
}

td.label{
  font-size:16px;
  font-weight:bold;
  width:25%;
}

td.meaning{
  font-size:14px;
  color:#444;
  width:35%;
}

/* â˜… å…¥åŠ›æ¬„UIä¿®æ­£ã®æ ¸å¿ƒ */
.input-wrap{
  display:flex;
  align-items:center;
  gap:6px;
}
.input-wrap input{
  flex:1;
  width:auto;
}
.input-wrap button{
  flex:0 0 auto;
  width:36px;
  height:36px;
  padding:0;
}

.toggle-btn{
  font-size:13px;
}

@media(max-width:600px){
  th,td{font-size:14px;}
  .input-wrap{
    flex-direction:column;
    align-items:stretch;
  }
}
</style>
</head>
<body>

<h1>ã‚´ãƒ«ãƒ•ã‚¯ãƒ©ãƒ–è©•ä¾¡</h1>

<div class="topbox">
  è©•ä¾¡è€…åï¼ˆå¿…é ˆï¼‰<br>
  <div class="input-wrap">
    <input type="text" id="evaluator" placeholder="ä¾‹ï¼šå±±ç”° å¤ªéƒ" oninput="saveData()">
    <button onclick="voiceInput('evaluator')">ğŸ¤</button>
  </div>
</div>

<button onclick="exportCSV()">ğŸ“„ CSVå‡ºåŠ›</button>

<div id="samples"></div>

<script>
/* ===============================
   â˜… ä½œæˆè€…ãŒç·¨é›†ã™ã‚‹ã®ã¯ã“ã“ã ã‘ â˜…
   =============================== */
const SAMPLE_NAMES = [
  "24AKA 10.5 TATAKI50",
  "24AKA 10.5 SMOOTH60",
  "24AKA 9.5 TATAKI50"
];

const STORAGE_KEY="golf_eval_fixed";

const items=[
 {key:"dist",label:"é£›è·é›¢",meaning:"1:é£›ã°ãªã„ / 5:ã‚ˆãé£›ã¶"},
 {key:"easy",label:"æ‰“ã¡ã‚„ã™ã•",meaning:"1:é›£ã—ã„ / 5:éå¸¸ã«æ˜“ã—ã„"},
 {key:"up",label:"ä¸Šã‚Šæ˜“ã•",meaning:"1:ä¸ŠãŒã‚‰ãªã„ / 5:éå¸¸ã«ä¸ŠãŒã‚‹"},
 {key:"launch",label:"æ‰“ã¡å‡ºã—(é«˜ä½)",meaning:"1:ä½ã„ / 5:é«˜ã„"},
 {key:"traj",label:"å¼¾é“",meaning:"1:å¼±ã„ / 5:å¼·ã„"},
 {key:"dir",label:"æ–¹å‘æ€§",meaning:"1:æ‚ªã„ / 5:è‰¯ã„"},
 {key:"meet",label:"ãƒŸãƒ¼ãƒˆç‡",meaning:"1:æ‚ªã„ / 5:è‰¯ã„"},
 {key:"swing",label:"æŒ¯ã‚Šã‚„ã™ã•",meaning:"1:æŒ¯ã‚Šã«ãã„ / 5:æŒ¯ã‚Šã‚„ã™ã„"},
 {key:"comment",label:"ã‚³ãƒ¡ãƒ³ãƒˆ",meaning:"è‡ªç”±è¨˜è¿°"}
];

function addSample(index,name){
  const wrap=document.createElement("div");
  wrap.className="card";
  wrap.innerHTML=`
  <div class="header">
    <strong>ã‚µãƒ³ãƒ—ãƒ« ${index+1}</strong>
    <button class="toggle-btn" onclick="toggleSample(this)">â–² æŠ˜ã‚ŠãŸãŸã‚€</button>
  </div>

  <div class="topbox">
    ã‚µãƒ³ãƒ—ãƒ«å<br>
    <div class="fixed-name">${name}</div>
  </div>

  <div class="content">
    <table>
      <tr><th>é …ç›®</th><th>å…¥åŠ›</th><th>ç›®å®‰</th></tr>
      ${items.map(i=>{
        const id=`s${index}_${i.key}`;
        return `
        <tr>
          <td class="label">${i.label}</td>
          <td>
            <div class="input-wrap">
              ${
                i.key==="comment"
                ? `<input type="text" id="${id}" oninput="saveData()">`
                : `<input type="number" min="1" max="5" step="1" id="${id}" oninput="saveData()">`
              }
              <button onclick="voiceInput('${id}')">ğŸ¤</button>
            </div>
          </td>
          <td class="meaning">${i.meaning}</td>
        </tr>`;
      }).join("")}
    </table>
  </div>`;
  document.getElementById("samples").appendChild(wrap);
}

function toggleSample(btn){
  const content=btn.closest(".card").querySelector(".content");
  if(content.style.display==="none"){
    content.style.display="";
    btn.textContent="â–² æŠ˜ã‚ŠãŸãŸã‚€";
  }else{
    content.style.display="none";
    btn.textContent="â–¼ é–‹ã";
  }
}

function voiceInput(id){
  if(!('webkitSpeechRecognition'in window)){
    alert("ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°å…¥åŠ›ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“");
    return;
  }
  const rec=new webkitSpeechRecognition();
  rec.lang="ja-JP";
  rec.start();
  rec.onresult=e=>{
    const el=document.getElementById(id);
    el.value=e.results[0][0].transcript.replace(/[^\d]/g,'') || e.results[0][0].transcript;
    saveData();
  };
}

function saveData(){
  const data={
    evaluator:document.getElementById("evaluator").value,
    samples:[]
  };
  SAMPLE_NAMES.forEach((n,i)=>{
    const obj={name:n};
    items.forEach(it=>{
      const el=document.getElementById(`s${i}_${it.key}`);
      obj[it.key]=el?el.value:"";
    });
    data.samples.push(obj);
  });
  localStorage.setItem(STORAGE_KEY,JSON.stringify(data));
}

function loadData(){
  SAMPLE_NAMES.forEach((n,i)=>addSample(i,n));
  const raw=localStorage.getItem(STORAGE_KEY);
  if(!raw)return;
  const d=JSON.parse(raw);
  document.getElementById("evaluator").value=d.evaluator||"";
  d.samples.forEach((s,i)=>{
    items.forEach(it=>{
      const el=document.getElementById(`s${i}_${it.key}`);
      if(el)el.value=s[it.key]||"";
    });
  });
}

function exportCSV(){
  if(!document.getElementById("evaluator").value.trim()){
    alert("è©•ä¾¡è€…åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
    return;
  }
  const rows=[];
  const header=["è©•ä¾¡è€…","æ—¥æ™‚","ã‚µãƒ³ãƒ—ãƒ«å",...items.map(i=>i.label)];
  rows.push(header);
  const now=new Date().toLocaleString();

  SAMPLE_NAMES.forEach((n,i)=>{
    const row=[document.getElementById("evaluator").value,now,n];
    items.forEach(it=>{
      row.push(document.getElementById(`s${i}_${it.key}`).value);
    });
    rows.push(row);
  });

  const csv="\uFEFF"+rows.map(r=>r.map(v=>`"${v}"`).join(",")).join("\n");
  const a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
  a.download="golf_eval.csv";
  a.click();
}

loadData();
</script>

</body>
</html>

